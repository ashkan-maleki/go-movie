version: '3.7'


services:
  metadata:
    image: ashkanmaleki/metadata:1.0.0
    container_name: metadata
    hostname: metadata
#    build:
#      context: .
##      dockerfile: ../../dockerfile/Dockerfile
#      dockerfile: ../../dockerfile/Dockerfile-test
#      args:
#        service: metadata
    expose:
      - '8081'
    environment:
      ENVIRONMENT: development
      SERVICE_DISCOVERY_URL: "consul-agent:8500"
      HTTP_SERVER_PORT: 8081
      PROMETHEUS_METRICS_PORT: 8091
      JAEGER_URL: http://localhost:14268/api/traces
    depends_on:
      - db
      - agent
      - zoo1
      - kafka1
#    command: [ "/movie/service" ]

  movie:
    container_name: movie
    hostname: movie
    build:
      context: .
#      dockerfile: ../../dockerfile/Dockerfile
      dockerfile: ../../dockerfile/Dockerfile-test
      args:
        service: movie
    expose:
      - '8083'
    environment:
      ENVIRONMENT: development
      CONFIG_FILE: "movie/base.yaml"
      SERVICE_DISCOVERY_URL: "consul-agent:8500"
    depends_on:
      - db
      - agent
      - zoo1
      - kafka1
#    command: [ "/movie/service" ]

  rating:
    container_name: rating
    hostname: rating
    build:
      context: .
#      dockerfile: ../../dockerfile/Dockerfile-csg-enabled
      dockerfile: ../../dockerfile/Dockerfile-test
      args:
        service: rating
    expose:
      - '8082'
    environment:
      ENVIRONMENT: development
      CONFIG_FILE: "movie/base.yaml"
      SERVICE_DISCOVERY_URL: "consul-agent:8500"
      KAFKA_ADDRESS: "kafka1:19092"
    depends_on:
      - db
      - agent
      - zoo1
      - kafka1
#    command: [ "/movie/service" ]